2014-09-18 22:13:55
当前目标：
能输入中英文
能换行（硬换行）
能自动换行（软换行）
不能删除
不能移动光标（只能在尾部插入）

2014-09-18 22:36:01
inputMethodEvent能够触发的条件是
QWidget.setAttribute(Qt.WA_InputMethodEnabled)
QWidget.hasFocus()

drawText() 可以自动wrap汉字，但对连续英文并不会
所以需要自己处理每个字符的绘制
text layout?

2015-01-28 21:20:13
重新开始，希望能每天写上一点，直到能开eno(目前的想法是edi写到富文本编辑器的地步就开eno)

好久以来重拾python手特别生，qt也是，，一步步来
简单目标：
[goal done]
按键能在窗口中显示英文

ctrl, shift 之类按键在 keyPressEvent() 的 .text() 是空字符串，所以验证是否 printable 需要：
if ch and ch in string.printable

[goal done]
添加 backspace、回车功能，在 console 中显示字符串，例如：
********************
*hello world       *
*this is a test    *
*                  *
********************
星号是模拟的窗口

ctrl-j 是 \r
ctrl-m 是 \n
backspace 是 0x08

\r 也在string.printable里(属于whitespace)，\n不属于，，那么对字符要优先判断是否是回车

2015-01-28 23:23:57
下一步比较复杂了(在widget中显示)，想做得好可能涉及到QTextLayout

貌似QTextLayout不会自己handle new line？那么 .createLine() 创建的原来不是文本中的“行(以换行符为界)”，而是paint device中的“行(以宽度为界)”？
让我试验一下

还真是

2015-01-28 23:59:21
done，不过写得比较乱——各种实验修修改改才ok起来，，不过可以在widget中显示英文了，backspace和回车也能用
接下来的任务或者搞中文或者仔细研究下QTextLayout
睡了

2015-01-29 12:46:27
很长的一行word wrap后，下面的行会与本行重合
另外，widget改变size后没有重新layout

把layout放在paintEvent里就可以保证widget size改变时重新layout

layout的boundingRect基本上只有width、height等有意义，多行layout时position要每一个加上上一layout的height

下面尝试一下更改word wrap的形式——改成字符wrap

QTextLayout不会handle tab——呃，好像是还有个QTextOption需要设置？

QTextDocument是更高层的工具，QTextLayout相当于只负责document中的一个element
但我不确定自己是不是要直接使用这么高层的工具，，更想自己从底层写起

通过QTextOption可以设置wrap mode


有点儿明白QTextLayout的意思了，它就像一个盒子，装了些字符，把它们排列起来
至于这个盒子往哪里画，仍是画的时候才指定的——也就是说，盒子中字符的位置都是相对的
上面是因为下一步打算做scroll，想了想琢磨出来的

恩...做scroll涉及到“保证哪个位置必须可见”的问题(呃，我是说正常打字的情况下，不用滚轮)，这就牵扯到光标，，那么下一步有好几项：

[goal]
光标
    delete、方向键
scroll (vertical - 因为图形行都会自动wrap)

顺便想远一点：
[goal]
中文支持
文件读写
行号
复制、粘贴
undo/redo
字体(字号)
背景色、前景色
edit/view
图片(view中是图片，edit中是文件地址或文件hash)
    进一步：资源链接
历史记录

到这里差不多就能转eno了，啊哈哈哈哈

2015-01-31 12:38:22
[goal]
光标
    光标的显示(尾部)(I型、block型) [done]
    键盘上下左右移动 [done]
    鼠标点选移动
    在光标处输入、删除(backspace、delete)
    
重构一下，做一个document的class

[goal]
cursor home/end/ctrl-home/ctrl-end

2015-01-31 14:09:21
鼠标点选光标做起来还比较复杂
需要根据确定坐标点在了哪个layout里，然后根据行高计算是第几行，拿到该行的QTextLine后根据x坐标确定cursor位置

可以想见之后做到富文本的时候，涉及到各种图形元素及排版，坐标 <-> 光标 互换会更复杂，，不过倒算明白做法了
